<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>GT-–ë–æ—Ç ¬∑ –î–∞—à–±–æ—Ä–¥</title>

  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="GT-–ë–æ—Ç">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

<style>
  :root{
    --bg:#0f1115; --card:#171a21; --muted:#8a8f98; --text:#e9edf1; 
    --green:#1ec28b; --red:#ff6b6b; --border:#2a2f3a; --accent:#4f86ff;
  }
  body{
    margin:0; font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial;
    background:var(--bg); color:var(--text);
  }
  header{position:sticky; top:0; background:#1a1f28; padding:8px; font-size:14px}
  .wrap{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  h1{font-size:16px; margin:0;}
  .pill{padding:2px 6px; border:1px solid var(--border); border-radius:6px; font-size:11px; color:var(--muted)}
  main{padding:10px; display:grid; gap:12px}
  .card{background:var(--card); border:1px solid var(--border); border-radius:10px; overflow:hidden}
  .card h2{margin:0; padding:10px; font-size:14px; border-bottom:1px solid var(--border)}
  .meta{padding:6px 10px; font-size:11px; color:var(--muted); border-bottom:1px solid var(--border)}
  .grid{overflow-x:hidden}  /* ‚ùå —É–±–∏—Ä–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É */
  table{width:100%; border-collapse:collapse; font-size:11px; table-layout:auto} /* –∞–≤—Ç–æ-—à–∏—Ä–∏–Ω–∞ */
  th,td{padding:6px 4px; border-bottom:1px solid var(--border); text-align:center; white-space:nowrap}
  th{background:#1a1f28; color:#c8ccd3; position:sticky; top:0}
  .buy{color:var(--green); font-weight:600}
  .sell{color:var(--red); font-weight:600}
  .pos{color:var(--green)}
  .neg{color:var(--red)}
  .muted{color:var(--muted)}
  footer{padding:6px; font-size:11px; color:var(--muted); text-align:center}
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>GT-–ë–æ—Ç</h1>
      <span id="status" class="pill">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</span>
      <span id="updated" class="pill">‚Äî</span>
    </div>
  </header>

  <main>
    <section class="card">
      <h2>üìä –ü–æ—Ä—Ç—Ñ–µ–ª—å</h2>
      <div class="meta">
        –°–≤–æ–±–æ–¥–Ω—ã–µ USDT: <b id="pfFree">‚Äî</b> ¬∑ –ü–æ—Ä—Ç—Ñ–µ–ª—å: <b id="pfTotal">‚Äî</b>
      </div>
      <div class="grid"><table id="portfolio"></table></div>
    </section>

    <section class="card">
      <h2>üìë –û—Ç–∫—Ä—ã—Ç—ã–µ –æ—Ä–¥–µ—Ä–∞</h2>
      <div class="meta">–ê–∫—Ç–∏–≤–Ω—ã—Ö: <b id="ooCount">‚Äî</b></div>
      <div class="grid"><table id="orders"></table></div>
    </section>
  </main>

  <footer>–î–æ–±–∞–≤—å –Ω–∞ iPhone: –ü–æ–¥–µ–ª–∏—Ç—å—Å—è ‚Üí ¬´–ù–∞ —ç–∫—Ä–∞–Ω –î–æ–º–æ–π¬ª</footer>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxfMjbnI3FJXB5A29d0okRRelF4-I-4tEBddCWAbWUPJhSJRAEvpbC8DFOsv4Bxbs_m9A/exec";

function clsPnL(v){
  const x = parseFloat(v);
  if (isNaN(x) || x===0) return 'muted';
  return x>0 ? 'pos' : 'neg';
}

function renderTable(id, rows){
  const table = document.getElementById(id);
  table.innerHTML = "";
  if (!rows || !rows.length){
    table.innerHTML = "<tr><td class='muted'>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>";
    return;
  }
  rows.forEach((row, i)=>{
    const tr = document.createElement("tr");
    row.forEach((cell, j)=>{
      const tag = i===0 ? "th" : "td";
      const td  = document.createElement(tag);
      let val   = String(cell).trim();

      if (id==='orders' && i>0 && j===3) td.className = val==="BUY"?"buy":val==="SELL"?"sell":"";
      if (id==='portfolio' && i>0 && (j===5 || j===6)) td.className = clsPnL(val);

      td.textContent = val;
      tr.appendChild(td);
    });
    table.appendChild(tr);
  });
}

async function loadData(){
  try{
    document.getElementById('status').textContent="–û–±–Ω–æ–≤–ª—è—é‚Ä¶";
    const res = await fetch(API_URL+"?only=portfolio");
    const data = await res.json();
    renderTable("portfolio", data.portfolio);
    if (data.openOrders) renderTable("orders", data.openOrders);
    document.getElementById('pfFree').textContent = "—Å–º. —Ç–∞–±–ª–∏—Ü—É";
    document.getElementById('pfTotal').textContent= "—Å–º. —Ç–∞–±–ª–∏—Ü—É";
    document.getElementById('ooCount').textContent= (data.openOrders?.length||1)-1;
    document.getElementById('updated').textContent= new Date().toLocaleTimeString();
    document.getElementById('status').textContent="–û–Ω–ª–∞–π–Ω";
  }catch(e){
    document.getElementById('status').textContent="–û—à–∏–±–∫–∞";
  }
}

loadData();
setInterval(loadData, 60000); // –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É
</script>
</body>
</html>
