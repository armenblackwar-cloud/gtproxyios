Index 

<!DOCTYPE html>

<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>GT ¬∑ Dashboard</title>
  <style>
    :root{
      --bg:#0f0f12; --card:#171a21; --muted:#8a8f98; --text:#e9edf1;
      --green:#00c087; --red:#f6465d; --border:#2a2f3a; --yellow:#f0b90b;
    }

```
* { box-sizing: border-box; }

body{
  margin:0; 
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial;
  background:var(--bg); 
  color:var(--text); 
  padding-top: env(safe-area-inset-top);
  font-size: 12px;
  overflow-x: hidden;
}

header{
  position:sticky; 
  top:0; 
  background:#1a1f28; 
  padding:8px; 
  display:flex; 
  flex-direction:column; 
  gap:6px;
  z-index: 100;
}

h1{
  font-size:16px; 
  margin:0; 
  color:var(--yellow);
  text-align: center;
}

.pill{
  padding:4px 8px; 
  border-radius:6px; 
  font-size:10px; 
  font-weight:600; 
  text-align:center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.pill.online{background:#193e2d; color:var(--green);}
.pill.offline{background:#3e1919; color:var(--red);}
.pill.pos{background:#193e2d; color:var(--green);}
.pill.neg{background:#3e1919; color:var(--red);}
.pill.muted{background:#333; color:var(--muted);}

.header-top{
  display:flex; 
  gap:8px; 
  align-items:center; 
  justify-content: space-between;
}

.header-metrics{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 4px;
  margin-top: 4px;
}

.header-metrics .pill{
  font-size: 9px;
  padding: 3px 6px;
}

#switchBtn{
  background:#333; 
  cursor:pointer; 
  border: none;
  color: var(--text);
  font-size: 10px;
}

main{
  padding:8px; 
  display:flex; 
  flex-direction: column;
  gap:12px;
}

.card{
  background:var(--card); 
  border:1px solid var(--border); 
  border-radius:8px; 
  overflow:hidden;
}

.card h2{
  margin:0; 
  padding:8px; 
  font-size:13px; 
  border-bottom:1px solid var(--border); 
  color:var(--yellow);
  text-align: center;
}

.table-container{
  overflow-x: hidden;
  width: 100%;
}

table{
  width:100%; 
  border-collapse:collapse; 
  font-size:9px;
}

th, td{
  padding:4px 2px;
  border-bottom:1px solid var(--border);
  text-align:center;
  vertical-align: middle;
  word-break: break-word;
  overflow: hidden;
}

th{
  background:#1a1f28; 
  color:#c8ccd3; 
  font-size:8px; 
  position:sticky; 
  top:0;
  font-weight: 600;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –ø–æ—Ä—Ç—Ñ–µ–ª—è */
#portfolio th:nth-child(1), #portfolio td:nth-child(1) { width: 20%; } /* –ê–∫—Ç–∏–≤ */
#portfolio th:nth-child(2), #portfolio td:nth-child(2) { width: 15%; } /* –ö–æ–ª-–≤–æ */
#portfolio th:nth-child(3), #portfolio td:nth-child(3) { width: 15%; } /* –¶–µ–Ω–∞ */
#portfolio th:nth-child(4), #portfolio td:nth-child(4) { width: 18%; } /* –°—Ç–æ–∏–º–æ—Å—Ç—å */
#portfolio th:nth-child(5), #portfolio td:nth-child(5) { width: 12%; } /* PNL% */
#portfolio th:nth-child(6), #portfolio td:nth-child(6) { width: 20%; } /* PNL ‚ÇΩ/$ */

/* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –æ—Ä–¥–µ—Ä–æ–≤ */
#orders th:nth-child(1), #orders td:nth-child(1) { width: 20%; } /* –ê–∫—Ç–∏–≤ */
#orders th:nth-child(2), #orders td:nth-child(2) { width: 15%; } /* –¢–∏–ø */
#orders th:nth-child(3), #orders td:nth-child(3) { width: 15%; } /* –ö–æ–ª-–≤–æ */
#orders th:nth-child(4), #orders td:nth-child(4) { width: 18%; } /* –¶–µ–Ω–∞ */
#orders th:nth-child(5), #orders td:nth-child(5) { width: 16%; } /* –í—Ä–µ–º—è */
#orders th:nth-child(6), #orders td:nth-child(6) { width: 16%; } /* –°—Ç–∞—Ç—É—Å */

.buy{color:var(--green); font-weight:600}
.sell{color:var(--red); font-weight:600}
.pos{color:var(--green); font-weight:600}
.neg{color:var(--red); font-weight:600}
.muted{color:var(--muted)}

.sectionRow{
  text-align:center; 
  font-weight:700; 
  color:var(--yellow); 
  background:#222; 
  padding:6px;
}

footer{
  padding:8px; 
  font-size:10px; 
  color:var(--muted); 
  text-align:center;
  margin-bottom: env(safe-area-inset-bottom);
}

#startScreen{
  display:flex; 
  flex-direction:column; 
  justify-content:center; 
  align-items:center; 
  height:100vh; 
  gap:24px;
  padding: 20px;
}

.startBtn{
  background:var(--yellow); 
  color:#000; 
  font-weight:700; 
  border:none; 
  border-radius:12px; 
  padding:16px 32px; 
  font-size:16px; 
  cursor:pointer;
  width: 100%;
  max-width: 280px;
}

.btnRow{
  display: flex;
  gap: 8px;
  padding: 8px;
  justify-content: center;
}

.logout{
  background:#333; 
  cursor:pointer; 
  padding:8px 16px; 
  border: none;
  border-radius:8px; 
  font-size:11px;
  color: var(--text);
  flex: 1;
  max-width: 140px;
}

/* –°–∫—Ä—ã–≤–∞–µ–º –ª–∏—à–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
@media (max-width: 360px) {
  .header-metrics {
    grid-template-columns: 1fr;
  }
  
  table { font-size: 8px; }
  th, td { padding: 2px 1px; }
  
  .pill { font-size: 8px; padding: 2px 4px; }
}

/* –£–±–∏—Ä–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É */
html, body {
  overflow-x: hidden;
  width: 100%;
}

.card {
  min-width: 0; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç—É —Å–∂–∏–º–∞—Ç—å—Å—è */
}
```

  </style>
</head>
<body>

<div id="startScreen">
  <h1>üöÄ GT</h1>
  <button class="startBtn" onclick="chooseMode('kripto')">GT-CRYPTO</button>
  <button class="startBtn" onclick="chooseMode('invest')">GT-INVEST</button>
</div>

<div id="app" style="display:none">
  <header>
    <div class="header-top">
      <h1 id="modePill">‚Äî</h1>
      <span id="status" class="pill">‚Äî</span>
      <button id="switchBtn" class="pill">üîÑ</button>
    </div>

```
<div class="header-metrics">
  <span id="pfFree" class="pill">–°–≤–æ–±–æ–¥–Ω—ã–µ: ‚Äî</span>
  <span id="pfTotal" class="pill">–û–±—ä–µ–º: ‚Äî</span>
  <span id="pfPnlPct" class="pill">PNL %: ‚Äî</span>
  <span id="pfPnlRub" class="pill">PNL ‚ÇΩ/$: ‚Äî</span>
</div>

<div style="text-align: center; margin-top: 4px;">
  <span id="updated" class="pill" style="font-size: 8px;">‚Äî</span>
</div>
```

  </header>

  <main>
    <section class="card">
      <h2>üìä –ü–æ—Ä—Ç—Ñ–µ–ª—å</h2>
      <div class="table-container">
        <table id="portfolio"></table>
      </div>
    </section>

```
<section class="card">
  <h2>üìë –û—Ä–¥–µ—Ä–∞ (<b id="ooCount">‚Äî</b>)</h2>
  <div class="table-container">
    <table id="orders"></table>
  </div>
</section>
```

  </main>

  <div class="btnRow">
    <button id="logoutBtn" class="logout">üö™ –í—ã–π—Ç–∏</button>
    <button id="copyBtn" class="logout">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
  </div>

  <footer>
    üì± –î–æ–±–∞–≤—å –Ω–∞ iPhone: –ü–æ–¥–µ–ª–∏—Ç—å—Å—è ‚Üí ¬´–ù–∞ —ç–∫—Ä–∞–Ω –î–æ–º–æ–π¬ª
  </footer>
</div>

<script>
// ====== –ü–∞—Ä–æ–ª—å ======
const PASSWORD = "Gt4815162342!";
const STORAGE_KEY = "gtbot_auth";
if (localStorage.getItem(STORAGE_KEY) !== "ok") {
  const input = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞:");
  if (input === PASSWORD) {
    localStorage.setItem(STORAGE_KEY, "ok");
  } else {
    document.body.innerHTML = "<h2 style='color:red;text-align:center;margin-top:50px'>‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω</h2>";
    throw new Error("Access denied");
  }
}

// ====== API ======
const API_URLS = {
  kripto: "https://script.google.com/macros/s/AKfycbxfMjbnI3FJXB5A29d0okRRelF4-I-4tEBddCWAbWUPJhSJRAEvpbC8DFOsv4Bxbs_m9A/exec",
  invest: "https://script.google.com/macros/s/AKfycbwTsu4LskXHYxx7x9QpA9u-eACTZsPWvjrvDF72nE0oScpAA7lf5a39ZDZWRTC2V8APpw/exec"
};

let currentMode = localStorage.getItem("gtbot_mode") || null;

function chooseMode(mode){
  currentMode = mode;
  localStorage.setItem("gtbot_mode", mode);
  document.getElementById("startScreen").style.display="none";
  document.getElementById("app").style.display="block";
  loadData();
  updateModePill();
}

function updateModePill(){
  document.getElementById("modePill").textContent =
    currentMode==="kripto" ? "GT-CRYPTO" : "GT-INVEST";
}

// ===== Helpers =====
function clsPnL(v){
  const num = parseFloat(String(v).replace(',', '.').replace(/\s+/g,''));
  if (isNaN(num) || num === 0) return 'muted';
  return num > 0 ? 'pos' : 'neg';
}
function applyPillClassRaw(el, value, label){
  const num = parseFloat(value);
  if(isNaN(num) || num===0){
    el.className = "pill muted";
  } else if(num > 0){
    el.className = "pill pos";
  } else {
    el.className = "pill neg";
  }
  el.textContent = label + ": " + value;
}

// ===== Render =====
function renderTable(id, rows){
  const table = document.getElementById(id);
  table.innerHTML = "";
  if (!rows || !rows.length){
    table.innerHTML = "<tr><td class='muted' colspan='6'>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>";
    return;
  }

  rows.forEach((row,i)=>{
    let filteredRow = row;
    if (id==='orders'){ 
      filteredRow = [row[2], row[3], row[4], row[6], row[7], row[8]]; 
    }
    if (id==='portfolio'){ 
      if(currentMode==="kripto"){
        filteredRow = [row[0], row[1], row[2], row[3], row[4], row[5], row[6], row[7]];
      } else {
        filteredRow = [row[0], row[1], row[2], row[3], row[4], row[5], row[6], row[7]];
      }
    }

    const firstCell = String(filteredRow[0]||"").toLowerCase();
    const isSection = firstCell.includes("–∞–∫—Ü–∏–∏") || firstCell.includes("—Ñ–æ–Ω–¥—ã") || firstCell.includes("–≤–∞–ª—é—Ç") || firstCell.includes("–º–µ—Ç–∞–ª–ª");

    const tr = document.createElement("tr");

    if(isSection){
      const td = document.createElement("td");
      td.colSpan = filteredRow.length;
      td.textContent = row[0];
      td.className = "sectionRow";
      tr.appendChild(td);
    } else {
      filteredRow.forEach((cell,j)=>{
        const tag = i===0?"th":"td";
        const td=document.createElement(tag);
        let val = (cell===undefined || cell===null) ? "" : String(cell).trim();
        
        // –°–æ–∫—Ä–∞—â–∞–µ–º –¥–ª–∏–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        if (tag === 'td' && val.length > 12 && !val.includes('%')) {
          val = val.substring(0, 10) + '..';
        }
        
        if (id==='orders' && i>0 && j===1){ 
          td.className=val==="BUY"?"buy":val==="SELL"?"sell":""; 
        }
        if (id==='portfolio' && i>0 && (j >= filteredRow.length-2)){ 
          td.className=clsPnL(val); 
        }
        
        td.textContent=val;
        tr.appendChild(td);
      });
    }
    table.appendChild(tr);
  });
}

// ===== Load =====
async function loadData(){
  if (!currentMode) return;
  try{
    document.getElementById('status').textContent="–ó–∞–≥—Ä—É–∑–∫–∞";
    document.getElementById('status').className="pill";
    const res = await fetch(API_URLS[currentMode]);
    const data = await res.json();

    renderTable("portfolio", data.portfolio);
    renderTable("orders", data.openOrders);
    document.getElementById('ooCount').textContent=(data.openOrders?.length||1)-1;

    let free="‚Äî", total="‚Äî", pnlVal="‚Äî", pnlPct="‚Äî", updated="";

    try{
      if(currentMode === "invest"){
        for (let i=0; i<data.portfolio.length; i++){
          const row = data.portfolio[i];
          const ticker = String(row[0] || "").toUpperCase();
          if (ticker === "RUB") free = row[5];
          const k = String(row[9] || "").toLowerCase();
          const v = data.portfolio[i+1] ? data.portfolio[i+1][9] : "";
          if (k.includes("—Å—Ç–æ–∏–º–æ—Å—Ç—å")) total = v;
          if (k.includes("pnl ‚ÇΩ")) pnlVal = v;
          if (k.includes("pnl %")) pnlPct = v;
        }
      } else {
        free    = data.portfolio[2]?.[9]  ?? "‚Äî";
        total   = data.portfolio[4]?.[9]  ?? "‚Äî";
        pnlVal  = data.portfolio[6]?.[9]  ?? "‚Äî";
        pnlPct  = data.portfolio[8]?.[9]  ?? "‚Äî";
        updated = data.portfolio[10]?.[9] ?? "";
      }
    }catch(_){}

    if(currentMode === "invest"){
      document.getElementById('pfFree').textContent = "–°–≤–æ–±–æ–¥–Ω—ã–µ: " + free + "‚ÇΩ";
      document.getElementById('pfTotal').textContent = "–û–±—ä–µ–º: " + total + "‚ÇΩ";
      applyPillClassRaw(document.getElementById('pfPnlRub'), pnlVal, "PNL ‚ÇΩ");
    } else {
      document.getElementById('pfFree').textContent = "–°–≤–æ–±–æ–¥–Ω—ã–µ: " + free + "$";
      document.getElementById('pfTotal').textContent = "–û–±—ä–µ–º: " + total + "$";
      applyPillClassRaw(document.getElementById('pfPnlRub'), pnlVal, "PNL $");
    }
    applyPillClassRaw(document.getElementById('pfPnlPct'), pnlPct, "PNL %");

    const now = new Date();
    const timeStr = updated || now.toLocaleString('ru-RU', {
      hour: '2-digit', 
      minute: '2-digit',
      day: '2-digit',
      month: '2-digit'
    });
    
    document.getElementById('updated').textContent = "–û–±–Ω–æ–≤–ª–µ–Ω–æ: " + timeStr;
    document.getElementById('status').textContent="Online";
    document.getElementById('status').className="pill online";
  }catch(e){
    document.getElementById('status').textContent="Offline";
    document.getElementById('status').className="pill offline";
  }
}

// Auto-refresh
setInterval(loadData, 60000);

// Switch mode
document.getElementById("switchBtn").onclick = () => { 
  chooseMode(currentMode==="kripto"?"invest":"kripto"); 
};

// Logout
document.getElementById('logoutBtn').onclick = () => { 
  localStorage.removeItem(STORAGE_KEY); 
  localStorage.removeItem("gtbot_mode"); 
  location.reload(); 
};

// Copy
document.getElementById('copyBtn').onclick = () => {
  function tableToText(id, title){
    const rows = [...document.getElementById(id).rows];
    if (!rows.length) return `${title}: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö\n`;
    let text = `\n### ${title}\n`;
    text += rows.map(r => [...r.cells].map(c => c.innerText).join(" | ")).join("\n");
    return text;
  }
  let out = "üìä –î–∞–Ω–Ω—ã–µ GT-BOT\n";
  out += tableToText("portfolio", "–ü–æ—Ä—Ç—Ñ–µ–ª—å");
  out += "\n";
  out += tableToText("orders", "–û—Ç–∫—Ä—ã—Ç—ã–µ –æ—Ä–¥–µ—Ä–∞");
  navigator.clipboard.writeText(out).then(()=>alert("‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ")).catch(()=>alert("‚ö† –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è"));
};

// Auto-start
if (currentMode){ 
  document.getElementById("startScreen").style.display="none"; 
  document.getElementById("app").style.display="block"; 
  updateModePill(); 
  loadData(); 
}
</script>

</body>
</html>
