<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>GT-–ë–æ—Ç ¬∑ –î–∞—à–±–æ—Ä–¥</title>
  <style>
    :root{
      --bg:#0f0f12; --card:#171a21; --muted:#8a8f98; --text:#e9edf1;
      --green:#00c087; --red:#f6465d; --border:#2a2f3a; --yellow:#f0b90b;
    }
    body{margin:0; font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial;
      background:var(--bg); color:var(--text); padding-top: env(safe-area-inset-top);}
    header{position:sticky; top:0; background:#1a1f28; padding:10px 6px; font-size:11px; display:flex; gap:6px; align-items:center; flex-wrap:wrap}
    h1{font-size:14px; margin:0; color:var(--yellow);}
    .pill{padding:1px 6px; border-radius:10px; font-size:10px; font-weight:600; min-width:55px; text-align:center}
    .pill.online{background:#193e2d; color:var(--green);}
    .pill.offline{background:#3e1919; color:var(--red);}
    .logout{background:#333; cursor:pointer; margin-left:auto; min-width:auto; padding:2px 8px}
    main{padding:6px; display:grid; gap:8px}
    .card{background:var(--card); border:1px solid var(--border); border-radius:8px; overflow:hidden}
    .card h2{margin:0; padding:6px; font-size:12px; border-bottom:1px solid var(--border); color:var(--yellow)}
    .grid{overflow-x:hidden}
    table{width:100%; border-collapse:collapse; font-size:7.5px; table-layout:fixed}
    th,td{padding:3px 2px; border-bottom:1px solid var(--border); text-align:center; white-space:nowrap}
    th{background:#1a1f28; color:#c8ccd3; font-size:8px; position:sticky; top:0}
    .buy{color:var(--green); font-weight:600}
    .sell{color:var(--red); font-weight:600}
    .pos{color:var(--green); font-weight:600}
    .neg{color:var(--red); font-weight:600}
    .muted{color:var(--muted)}
    footer{padding:4px; font-size:9px; color:var(--muted); text-align:center}

    /* —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ –º–µ–Ω—é */
    #startScreen{display:flex; flex-direction:column; justify-content:center; align-items:center; height:100vh; gap:20px}
    .startBtn{background:var(--yellow); color:#000; font-weight:700; border:none; border-radius:8px; padding:15px 25px; font-size:16px; cursor:pointer}
  </style>
</head>
<body>

<div id="startScreen">
  <h1>üöÄ GT-–ë–æ—Ç</h1>
  <button class="startBtn" onclick="chooseMode('kripto')">GT-KRIPTO</button>
  <button class="startBtn" onclick="chooseMode('invest')">GT-INVEST</button>
</div>

<div id="app" style="display:none">
  <header>
    <h1>GT-–ë–æ—Ç</h1>
    <span id="modePill" class="pill">‚Äî</span>
    <span id="status" class="pill">‚Äî</span>
    <span id="pfFree" class="pill">USDT: ‚Äî</span>
    <span id="pfTotal" class="pill">‚àë: ‚Äî</span>
    <span id="updated" class="pill">‚Äî</span>
    <button id="switchBtn" class="pill">üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å</button>
    <button id="logoutBtn" class="pill logout">üö™ –í—ã–π—Ç–∏</button>
  </header>

  <main>
    <section class="card">
      <h2>üìä –ü–æ—Ä—Ç—Ñ–µ–ª—å</h2>
      <div class="grid"><table id="portfolio"></table></div>
    </section>

    <section class="card">
      <h2>üìë –û—Ç–∫—Ä—ã—Ç—ã–µ –æ—Ä–¥–µ—Ä–∞ (<b id="ooCount">‚Äî</b>)</h2>
      <div class="grid"><table id="orders"></table></div>
    </section>
  </main>

  <footer>üì± –î–æ–±–∞–≤—å –Ω–∞ iPhone: –ü–æ–¥–µ–ª–∏—Ç—å—Å—è ‚Üí ¬´–ù–∞ —ç–∫—Ä–∞–Ω –î–æ–º–æ–π¬ª</footer>
</div>

<script>
// ====== –ü–∞—Ä–æ–ª—å ======
const PASSWORD = "Gt4815162342!";
const STORAGE_KEY = "gtbot_auth";
if (localStorage.getItem(STORAGE_KEY) !== "ok") {
  const input = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞:");
  if (input === PASSWORD) {
    localStorage.setItem(STORAGE_KEY, "ok");
  } else {
    document.body.innerHTML = "<h2 style='color:red;text-align:center;margin-top:50px'>‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω</h2>";
    throw new Error("Access denied");
  }
}

// ====== API –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ ======
const API_URLS = {
  kripto: "https://script.google.com/macros/s/AKfycbxfMjbnI3FJXB5A29d0okRRelF4-I-4tEBddCWAbWUPJhSJRAEvpbC8DFOsv4Bxbs_m9A/exec",
  invest: "https://script.google.com/macros/s/AKfycbwTsu4LskXHYxx7x9QpA9u-eACTZsPWvjrvDF72nE0oScpAA7lf5a39ZDZWRTC2V8APpw/exec"
};

let currentMode = localStorage.getItem("gtbot_mode") || null;

function chooseMode(mode){
  currentMode = mode;
  localStorage.setItem("gtbot_mode", mode);
  document.getElementById("startScreen").style.display="none";
  document.getElementById("app").style.display="block";
  loadData();
  updateModePill();
}

function updateModePill(){
  document.getElementById("modePill").textContent = currentMode==="kripto"?"GT-KRIPTO":"GT-INVEST";
}

// ===== –†–µ–Ω–¥–µ—Ä =====
function clsPnL(v){
  const num = parseFloat(String(v).replace(',', '.').replace(/\s+/g,''));
  if (isNaN(num) || num === 0) return 'muted';
  return num > 0 ? 'pos' : 'neg';
}
function renderTable(id, rows){
  const table = document.getElementById(id);
  table.innerHTML = "";
  if (!rows || !rows.length){
    table.innerHTML = "<tr><td class='muted'>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>";
    return;
  }
  rows.forEach((row,i)=>{
    let filteredRow = row;
    if (id==='orders'){ filteredRow = [row[2], row[3], row[4], row[6], row[7], row[8]]; }
    if (id==='portfolio'){ filteredRow = row.slice(0,7); }
    const tr = document.createElement("tr");
    filteredRow.forEach((cell,j)=>{
      const tag = i===0?"th":"td";
      const td=document.createElement(tag);
      const val=String(cell).trim();
      if (id==='orders' && i>0 && j===1){ td.className=val==="BUY"?"buy":val==="SELL"?"sell":""; }
      if (id==='portfolio' && i>0 && (j===5||j===6)){ td.className=clsPnL(val); }
      td.textContent=val;
      tr.appendChild(td);
    });
    table.appendChild(tr);
  });
}

// ===== –ó–∞–≥—Ä—É–∑–∫–∞ =====
async function loadData(){
  if (!currentMode) return;
  try{
    document.getElementById('status').textContent="–û–±–Ω–æ–≤–ª—è—é‚Ä¶";
    document.getElementById('status').className="pill";
    const res = await fetch(API_URLS[currentMode]);
    const data = await res.json();
    renderTable("portfolio", data.portfolio);
    renderTable("orders", data.openOrders);
    document.getElementById('ooCount').textContent=(data.openOrders?.length||1)-1;
    let free="‚Äî", total="‚Äî";
    try{
      const scan = data.portfolio.slice(0,3);
      for (const r of scan){
        for (let i=0;i<r.length-1;i++){
          const k=String(r[i]||'').toLowerCase();
          if (k.includes('—Å–≤–æ–±–æ–¥–Ω—ã–µ usdt')) free=r[i+1];
          if (k.includes('–æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—è')) total=r[i+1];
        }
      }
    }catch(_){}
    document.getElementById('pfFree').textContent="USDT: "+free;
    document.getElementById('pfTotal').textContent="‚àë: "+total;
    document.getElementById('updated').textContent=new Date().toLocaleString('ru-RU');
    document.getElementById('status').textContent="–û–Ω–ª–∞–π–Ω";
    document.getElementById('status').className="pill online";
  }catch(e){
    document.getElementById('status').textContent="–û—Ñ—Ñ–ª–∞–π–Ω";
    document.getElementById('status').className="pill offline";
  }
}

// –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
setInterval(loadData,60000);

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞
document.getElementById("switchBtn").onclick=()=>{
  chooseMode(currentMode==="kripto"?"invest":"kripto");
};

// üö™ –í—ã—Ö–æ–¥
document.getElementById('logoutBtn').onclick=()=>{
  localStorage.removeItem(STORAGE_KEY);
  localStorage.removeItem("gtbot_mode");
  location.reload();
};

// –ê–≤—Ç–æ-—Å—Ç–∞—Ä—Ç –µ—Å–ª–∏ —Ä–µ–∂–∏–º —É–∂–µ –≤—ã–±—Ä–∞–Ω
if (currentMode){
  document.getElementById("startScreen").style.display="none";
  document.getElementById("app").style.display="block";
  updateModePill();
  loadData();
}
</script>
</body>
</html>