<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>GT ¬∑ Dashboard</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f0f12">
  <style>
    :root{
      --bg:#0f0f12; --card:#171a21; --muted:#8a8f98; --text:#e9edf1;
      --green:#00c087; --red:#f6465d; --border:#2a2f3a; --yellow:#f0b90b;
    }
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial;
      background:var(--bg);color:var(--text);}
    .pill{padding:4px 8px;border-radius:6px;font-size:10px;font-weight:600;text-align:center;}
    .pill.online{background:#193e2d;color:var(--green);}
    .pill.offline{background:#3e1919;color:var(--red);}
    .btnRow{display:flex;gap:8px;justify-content:center;padding:8px;}
    .logout{background:#333;color:#fff;border:none;padding:8px 16px;border-radius:8px;cursor:pointer;}
  </style>
</head>
<body>
<div id="startScreen">
  <h1>üöÄ GT</h1>
  <button onclick="chooseMode('kripto')">GT-CRYPTO</button>
  <button onclick="chooseMode('invest')">GT-INVEST</button>
</div>

<div id="app" style="display:none">
  <header>
    <h2 id="modePill">‚Äî</h2>
    <span id="status" class="pill">‚Äî</span>
    <span id="updated" class="pill">‚Äî</span>
  </header>
  <main>
    <h3>üìä –ü–æ—Ä—Ç—Ñ–µ–ª—å</h3>
    <table id="portfolio"></table>
    <h3>üìë –û—Ä–¥–µ—Ä–∞ (<b id="ooCount">‚Äî</b>)</h3>
    <table id="orders"></table>
  </main>
  <div class="btnRow">
    <button id="logoutBtn" class="logout">üö™ –í—ã–π—Ç–∏</button>
    <button id="copyBtn" class="logout">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
  </div>
</div>

<script>
const PASSWORD="Gt4815162342!";
const STORAGE_KEY="gtbot_auth";
if(localStorage.getItem(STORAGE_KEY)!=="ok"){
  const input=prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞:");
  if(input===PASSWORD){localStorage.setItem(STORAGE_KEY,"ok");}
  else{document.body.innerHTML="<h2 style='color:red;text-align:center'>‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω</h2>";throw new Error("Access denied");}
}

const API_URLS={
  kripto:"–¢–í–û–ô_URL_CRYPTO",
  invest:"–¢–í–û–ô_URL_INVEST"
};
let currentMode=localStorage.getItem("gtbot_mode")||null;

function chooseMode(mode){
  currentMode=mode;
  localStorage.setItem("gtbot_mode",mode);
  document.getElementById("startScreen").style.display="none";
  document.getElementById("app").style.display="block";
  document.getElementById("modePill").textContent=mode==="kripto"?"GT-CRYPTO":"GT-INVEST";
  loadData();
}

async function loadData(){
  try{
    document.getElementById('status').textContent="‚è≥";
    const res=await fetch(API_URLS[currentMode]);
    const data=await res.json();
    renderTable("portfolio",data.portfolio);
    renderTable("orders",data.openOrders);
    document.getElementById('ooCount').textContent=(data.openOrders?.length||1)-1;
    document.getElementById('updated').textContent=new Date().toLocaleString('ru-RU');
    document.getElementById('status').textContent="–û–Ω–ª–∞–π–Ω";
    document.getElementById('status').className="pill online";
  }catch(e){
    document.getElementById('status').textContent="–û—Ñ—Ñ–ª–∞–π–Ω";
    document.getElementById('status').className="pill offline";
  }
}
function renderTable(id,rows){
  const t=document.getElementById(id);t.innerHTML="";
  if(!rows||!rows.length){t.innerHTML="<tr><td>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>";return;}
  rows.forEach(r=>{
    const tr=document.createElement("tr");
    r.forEach(c=>{
      const td=document.createElement("td");
      td.textContent=c;tr.appendChild(td);
    });
    t.appendChild(tr);
  });
}
document.getElementById('logoutBtn').onclick=()=>{localStorage.removeItem(STORAGE_KEY);localStorage.removeItem("gtbot_mode");location.reload();};
document.getElementById('copyBtn').onclick=()=>{
  const text=document.body.innerText;
  navigator.clipboard.writeText(text).then(()=>alert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ"));
};
if(currentMode){document.getElementById("startScreen").style.display="none";document.getElementById("app").style.display="block";loadData();}
if("serviceWorker" in navigator){navigator.serviceWorker.register("sw.js").catch(console.error);}
</script>
</body>
</html>